AddCSLuaFile() ArmAnim=nil ArmAnimMDL=nil ArmAnimString="nil" ArmAnimCycle=0 local attach=nil local attachId=nil local endtimemod=0 local weapontoidle=nil function RemoveArmAnim() local ply=LocalPlayer() if IsValid(ArmAnim) then ArmAnimMDL:SetNoDraw(true) ArmAnim:SetNoDraw(true) ArmAnimMDL:Remove() if IsValid(ArmAnimWEPMDL) then ArmAnimWEPMDL:Remove() end ArmAnim:Remove() ply:DrawViewModel(true) DidDraw = false end local currentwep=LocalPlayer():GetActiveWeapon() if IsValid(currentwep) then weapontoidle=currentwep currentwep:SendWeaponAnim(ACT_VM_DRAW) timer.Simple(LocalPlayer():GetViewModel():SequenceDuration(),function() if LocalPlayer():GetActiveWeapon()==weapontoidle and LocalPlayer():GetActiveWeapon().IronSights==nil and weapontoidle:GetSequenceName(weapontoidle:GetSequence())=="draw" then weapontoidle:SendWeaponAnim(ACT_VM_IDLE) end end) end end concommand.Add( "StartArmAnim", function(ply,cmd, args) ArmAnimString = tostring(args[1]) animmodelstring = args[2] endtimemod = args[3] or 0 if ArmAnimString==nil or !ply:Alive() then return end if IsValid(ArmAnimMDL) then RemoveArmAnim() return end 	ArmAnimCycle=0 	ArmAnim = ClientsideModel( "models/"..tostring(animmodelstring)..".mdl", RENDERGROUP_BOTH ) 	 	local viewmodelpos=ply:GetViewModel():GetPos() - ply:GetViewModel():GetForward()*3.5 	 	ArmAnim:SetPos( viewmodelpos ) 	ArmAnim:SetAngles( EyeAngles() ) 	ArmAnim:SetParent( ply:GetViewModel() ) 	 	 	ArmAnimMDL = ClientsideModel( ply:GetHands():GetModel(), RENDERGROUP_BOTH ) 	 	ArmAnimMDL:SetPos( viewmodelpos ) 	ArmAnimMDL:SetAngles( Angle(0,EyeAngles().y,0) ) 	ArmAnimMDL:SetParent( ArmAnim ) 	ArmAnimMDL:AddEffects(EF_BONEMERGE) 	 	ArmAnim:SetSequence(ArmAnimString) attachId = ArmAnim:LookupAttachment("Camera") attach = ArmAnim:GetAttachment(attachId) 	 end) function StartArmAnim(animstring,modelstring,endtimer) local ply=LocalPlayer() ArmAnimString = animstring animmodelstring = modelstring endtimemod = endtimer if ArmAnimString==nil or !ply:Alive() then return end if IsValid(ArmAnimMDL) then RemoveArmAnim() return end 	ArmAnimCycle=0 	ArmAnim = ClientsideModel( "models/"..tostring(animmodelstring)..".mdl", RENDERGROUP_BOTH ) 	 	local viewmodelpos=ply:GetViewModel():GetPos() - ply:GetViewModel():GetForward()*3.5 	 	ArmAnim:SetPos( viewmodelpos ) 	ArmAnim:SetAngles( EyeAngles() ) 	ArmAnim:SetParent( ply:GetViewModel() ) 	 	 	ArmAnimMDL = ClientsideModel( ply:GetHands():GetModel(), RENDERGROUP_BOTH ) 	 	ArmAnimMDL:SetPos( viewmodelpos ) 	ArmAnimMDL:SetAngles( Angle(0,EyeAngles().y,0) ) 	ArmAnimMDL:SetParent( ArmAnim ) 	ArmAnimMDL:AddEffects(EF_BONEMERGE) 	 	ArmAnim:SetSequence(ArmAnimString) attachId = ArmAnim:LookupAttachment("Camera") attach = ArmAnim:GetAttachment(attachId) end hook.Add("Think","ArmAnimThink",function() local ply=LocalPlayer() if IsValid(ArmAnim) then 	 if !ply:Alive() then RemoveArmAnim() return end ArmAnimCycle=ArmAnimCycle+FrameTime()/ArmAnim:SequenceDuration()*1 ArmAnim:SetCycle(ArmAnimCycle) local viewmodel=ply:GetViewModel() if IsValid(viewmodel) then viewmodel:SetNoDraw(true) end if ArmAnimCycle>=1+endtimemod then RemoveArmAnim() end end end) hook.Add("CreateMove","ArmLimitMove",function(cmd) if IsValid(ArmAnimMDL) then local ply=LocalPlayer() cmd:RemoveKey(IN_ATTACK) cmd:RemoveKey(IN_ATTACK2) cmd:RemoveKey(IN_RELOAD) end end) --[[hook.Add("CalcView","ArmAnimCalcView",function(ply,pos,angles,fov) if IsValid(ArmAnim) then 	local view = {} 	 	 	if attach!=nil then view.fov = fov 	view.angles = attach.Ang return view 	end end end) ]]